<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: OpenCPN Plugins Manual</title>
    <link rel="canonical" href="https://github.com/Rasbats/opencpn-plugins-manual/opencpn-plugins-manual/0.1/twocan/twocan.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <div class="navbar">
    <div class="navbar-brand">
      <div class="ocpn-logo"> </div>
      <a class="navbar-title"
         href="https://github.com/Rasbats/opencpn-plugins-manual"
      >
        OpenCPN Plugins Manual
        </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
       <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://www.opencpn.org">OpenCPN.org</a>
            <a class="navbar-item"
               href="https://opencpn.org/wiki/dokuwiki/doku.php?id=opencpn:opencpn_user_manual"
            >
               User Manual
               </a>
            <a class="navbar-item" href="https://github.com/opencpn/OpenCPN">
               Github Site
               </a>
            <a class="navbar-item" href="https://opencpn.org/flyspray/">
               Bugtracker
               </a>
            <a class="navbar-item"
                href="https://rasbats.github.io/opencpn-plugins-manual/">
                    Plugin Manual (pre-alpha)
               </a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="opencpn-plugins-manual" data-version="0.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">0.1 OpenCPN Plugins Manual</span>
    <span class="version">0.1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">0.1 OpenCPN Plugins Manual</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../dash-t/0.1/dash-t.html">Dashboard Tactics</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../dash-t/0.1/dash-t.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../dead_reckoning/0.1/dead_reckoning.html">DR</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../dead_reckoning/0.1/dead_reckoning.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../odraw/0.1/odraw.html">odraw</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../odraw/0.1/odraw.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../otcurrent/0.1/otcurrent.html">otcurrent</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../otcurrent/0.1/otcurrent.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../photolayer/0.1/photolayer.html">PhotoLayer</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../photolayer/0.1/photolayer.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../radar/0.1/Home.html">Radar Manual</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../radar/0.1/Home.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../sar/0.1/sar.html">SAR</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../sar/0.1/sar.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../shipdriver/0.1/shipdriver.html">ShipDriver</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../shipdriver/0.1/shipdriver.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../watchdog/2.4.29/watchdog.html">Watchdog</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../watchdog/2.4.29/watchdog.html">2.4.29</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="sect1">
<h2 id="_twocan"><a class="anchor" href="#_twocan"></a>TwoCan</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="_images/twocan_64.png" alt="twocan 64">
</div>
</div>
<div class="paragraph">
<p>by Steven Adler [Stevead]</p>
</div>
<div class="paragraph">
<p>Inspired by Canboat and Openskipper, frustrated by those who claim
“OpenCPN is not a hardware experimenter&#8217;s platform”, and desiring to
give back something to the OpenCPN community.</p>
</div>
<div class="paragraph">
<p>TwoCan - An OpenCPN Plugin for integrating OpenCPN with NMEA2000®
networks. It enables some NMEA2000® data to be directly integrated with
OpenCPN by converting some NMEA2000® messages to NMEA 183 sentences and
inserting them into the OpenCPN data stream. TwoCan support Windows,
Linux (including RaspberryPi) and Mac OSX.</p>
</div>
<div class="paragraph">
<p>For Windows it uses a “plug-in” driver model to support different CAN
bus adapters and different log file formats.<br>
Four hardware adapters are currently supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.kvaser.com/product/kvaser-leaf-light-hs-v2/">Kvaser
Leaflight HS v2</a></p>
</li>
<li>
<p><a href="http://canable.io/">Canable Contact</a></p>
</li>
<li>
<p><a href="http://www.axiomtek.com/Default.aspx?MenuId=Products&amp;FunctionId=ProductView&amp;ItemId=8270&amp;upcat=318&amp;C=AX92903">Axiomtek
AX92903</a></p>
</li>
<li>
<p><a href="http://www.rusoku.com/products/toucan-marine/">Rusoku Toucan Marine</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Four log file formats are currently supported (with examples of their
file format):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>TwoCan: 0x01,0x01,0xF8,0x09,0x64,0xD9,0xDF,0x19,0xC7,0xB9,0x0A,0x04</p>
</li>
<li>
<p>Candump (Linux utilty): (1542794025.315691) can0
1DEFFF03#A00FE59856050404</p>
</li>
<li>
<p>Kees Verruijt&#8217;s Canboat:
2014-08-14T19:00:00.042,3,128267,1,255,8,0B,F5,0D,8D,24,01,00,00</p>
</li>
<li>
<p>Yacht Devices: 19:07:47.607 R 0DF80503 00 2B 2D 9E 44 5A A0 A1</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For Windows, the default file name for each of the input log files are:
twocanraw.log, candump.log, kees.log and yachtdevices.log respectively.</p>
</div>
<div class="paragraph">
<p>For Linux it does not use a “plug-in” driver model, rather it uses two
“baked in” classes that support the SocketCAN interface and a generic
Log File Reader. Any CAN bus adapter that supports the SocketCAN
interface “should” work. It has been tested with native interfaces (eg.
can0), serial interfaces (eg. slcan0) and virtual interfaces (eg.
vcan0).</p>
</div>
<div class="paragraph">
<p>Several hardware adapters have been successfully tested under Linux:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Canable Cantact - (see above)</p>
</li>
<li>
<p>Rusoku Toucan Marine (see above)</p>
</li>
<li>
<p>Waveshare CAN Hat for Raspberry PI -
<a href="https://www.waveshare.com/rs485-can-hat.htm" class="bare">https://www.waveshare.com/rs485-can-hat.htm</a></p>
</li>
<li>
<p>USBTin - <a href="https://www.fischl.de/usbtin/">USBTin</a></p>
</li>
<li>
<p>Copperhill Tech PICAN-M for Raspberry Pi -
<a href="https://copperhilltech.com/pican-m-nmea-0183-nmea-2000-hat-for-raspberry-pi/" class="bare">https://copperhilltech.com/pican-m-nmea-0183-nmea-2000-hat-for-raspberry-pi/</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A good reference to using &amp; configuring the CAN interfaces on Linux can
be found at: <a href="https://elinux.org/Bringing_CAN_interface_up" class="bare">https://elinux.org/Bringing_CAN_interface_up</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/raspberrypi-01.png" alt="raspberrypi 01">
</div>
</div>
<div class="paragraph">
<p>Above, a Raspberry Pi with Waveshare CAN Hat installed.</p>
</div>
<div class="paragraph">
<p>The Linux Log File Reader automagically™ detects the four supported log
file formats. The default file name for the input log file is
twocan.log.</p>
</div>
<div class="paragraph">
<p>Similarly the Mac OSX version uses three “baked in” classes, one
supporting the generic Log File reader, one supporting the Rusoku Toucan
adapter (see above) and the other supporting serial USB CAN bus adapters
such as the Canable Cantact (also see above).</p>
</div>
<div class="paragraph">
<p>It seems as though the same command set is used by adapters that support
the serial SocketCAN interface (SLCAN), so while the Mac OSX plugin&#8217;s
Canable Cantact driver was developed purely for that device, it may also
work with other serial USB Can bus adapters such as the USBTin (see
above) and Lawicell adapters. The plugin automagically™ detects these
three adapters using their respective USB Vendor Id&#8217;s and product Id&#8217;s
and may work with serial USB devices other then the Canable Cantact.</p>
</div>
<div class="paragraph">
<p>NMEA 2000 frames may be logged by the plugin. By default they are
written to the user&#8217;s home directory and named using the following
convention: twocan-YYYY-MM-DD_HHmmSS.log</p>
</div>
<div class="paragraph">
<p>The TwoCan Plugin source code is available at
<a href="https://github.com/twocanplugin/twocanplugindrivers.git">https://github.com/twocanplugin/twocanplugin.git</a></p>
</div>
<div class="paragraph">
<p>The TwoCan Plugin Windows drivers are available at
<a href="https://github.com/twocanplugin/twocanplugindrivers.git" class="bare">https://github.com/twocanplugin/twocanplugindrivers.git</a></p>
</div>
<div class="sect2">
<h3 id="_aim"><a class="anchor" href="#_aim"></a>Aim</h3>
<div class="paragraph">
<p>The aim of the TwoCan plugin is to allow OpenCPN to integrate with
modern NMEA2000® networks and use the data directly from those sensors
without relying on additional gateways or converters. Navigation data
such as position, speed, depth, wind and time can be incorporated into
OpenCPN without the need for feeding legacy NMEA 0183 data via serial
communications or TCP/IP.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/twocan_screen_2.png." alt="twocan screen 2.png.">
</div>
</div>
<div class="paragraph">
<p>The plug-in supports Position, Speed, Depth. Wind, Time, AIS, DSC,
Engine, Fluid Levels, Battery Status and Environmental (temperature,
pressure, humidity etc.) data which is used directly by OpenCPN or by
other plug-ins such as the Dashboard plug-in.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/twocan_screen_0.png" alt="twocan screen 0">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installation"><a class="anchor" href="#_installation"></a>Installation</h3>
<div class="paragraph">
<p>With version 1.9 of the plugin, it is now directly supported by OpenCPN
5.2 and the Plugin Manager. Once you have updated your Master Catalogue,
the plugin can be directly installed from the Plugin Manager.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/twocan_install01.png" alt="twocan install01">
</div>
</div>
<div class="paragraph">
<p>For versions prior to 1.9</p>
</div>
<div class="paragraph">
<p>1. After compiling and creating the standalone installation
package for TwoCan, use the resulting installer to install the TwoCan
plugin.</p>
</div>
<div class="paragraph">
<p>2. If using Windows compile the TwoCan plugin drivers. At present
they do not have an installation package so you must manually copy the
drivers (Windows DLL&#8217;s) into the “twocan_pi\drivers” folder. This folder
will be found in the “plugins” folder of your OpenCPN installation which
in a default installation will be found in the “program files\opencpn”
folder on your System drive.</p>
</div>
<div class="paragraph">
<p>For example on a standard Windows system it may be: “c:\program
files\opencpn\plugins\twocan_pi\drivers”</p>
</div>
</div>
<div class="sect2">
<h3 id="_usage"><a class="anchor" href="#_usage"></a>Usage</h3>
<div class="paragraph">
<p>1. Enable the TwoCan Plugin from the OpenCPN Options dialog.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/twocan_screen_4.png" alt="twocan screen 4">
</div>
</div>
<div class="paragraph">
<p>2, From the TwoCan Preferences dialog, use the Settings tab to select
the appropriate driver from the drop down list, and select the required
NMEA2000® PGN&#8217;s,</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/twocan_screen_6.png" alt="twocan screen 6">
</div>
</div>
<div class="paragraph">
<p>For Linux users, if any SocketCAN driver is installed, it will be
displayed in the drop down list, together with the Log File Reader.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/twocan-linux-01.png" alt="twocan linux 01">
</div>
</div>
<div class="paragraph">
<p>If using the hardware drivers you may log the raw data. At present the
raw data is hard coded to write log files to the user&#8217;s home directory;
for Windows usually the “My Documents” folder, for Linux and Mac OSX,
“home” aka “~”</p>
</div>
<div class="paragraph">
<p>3. From the TwoCan Preferences dialog, you may use the Debug tab
to observe the converted NMEA 0183 sentences in real time. Sentences may
also be copied to the clipboard.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/twocan_screen_7.png" alt="twocan screen 7">
</div>
</div>
<div class="paragraph">
<p>Note: The same sentences may also be viewed from OpenCPN if the “Show
NMEA Debug Window” is selected from the OpenCPN Connection Settings
dialog.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/twocan_screen_3.png" alt="twocan screen 3">
</div>
</div>
<div class="paragraph">
<p>A new feature introduced with version 1.4 is the ability to enable
TwoCan to participate on the NMEA 2000® network. The TwoCan plugn will
acquire an address on the network and respond to a few network requests
such as requests for address claims, device capabilities and product
information. For the more technically minded, that means the Plugin
supports the following Parameter Group Number (PGN&#8217;s): 59904 ISO
Request, 60928 Address Claim, 126993 Heartbeat, 126996 Product
Information.</p>
</div>
<div class="paragraph">
<p>This feature is confgured on an additional settings page.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/twocan-activedevice.png" alt="twocan activedevice">
</div>
</div>
<div class="paragraph">
<p>In addition, the plugin attempts to build a “map” of the network by
listing all of the active devices on the network and attempting to
display their NMEA 2000® network address, manufacturer and model id.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/twocan-network.png" alt="twocan network">
</div>
</div>
<div class="paragraph">
<p>As the device responds to standard NMEA 2000® network requests, its
presence is also displayed on third party NMEA 2000® display devices.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/simrad-02.png" alt="]">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_settings"><a class="anchor" href="#_configuration_settings"></a>Configuration Settings</h3>
<div class="paragraph">
<p>The TwoCan plugin persists its configuration settings in the OpenCPN
initialization file. Under Windows this file is named “opencpn.ini” and
is located in the “ProgramData\OpenCPN ” folder. For Linux and Mac OSX
users, the OpenCPN initialization file is located in the .opencpn
directory in the user&#8217;s home directory.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="paragraph">
<p>[PlugIns/TwoCan]<br>
PGN=511<br>
Log=0<br>
Adapter=C:\\Program
Files\\OpenCPN\\plugins\\twocan_pi\\drivers\\kvaser.dll<br>
Mode=0</p>
</div>
</div>
<div class="sect2">
<h3 id="_problems"><a class="anchor" href="#_problems"></a>Problems</h3>
<div class="paragraph">
<p>The TwoCan plugin has undergone very limited testing.</p>
</div>
<div class="paragraph">
<p>It has occasionally crashed OpenCPN, when changing drivers mid stream or
selecting a driver for which the underlying hardware is not installed.
In this case, manually edit the OpenCPN initializaion file and delete or
correct the Adapter entry.</p>
</div>
<div class="paragraph">
<p>For Windows, the drivers that use serial communications (Canable Cantact
and Axiomtek AX92903) both attempt to automagically determine their
serial port settings but again this has undergone limited testing and
may not work correctly.</p>
</div>
<div class="paragraph">
<p>For Linux, the CAN interfaces must be “up”. In general the “ifconfig”
command can be used to determine the presence/state of the CAN adapters,
and the “ip link” command can be used to bring up the interface. Eg. For
a native interface the following command could be used: sudo ip link set
up can0.</p>
</div>
<div class="paragraph">
<p>For Mac OSX the plugin automagically detects the serial USB port that
the Canable Cantact device is connected to, whilst for the Rusoku Toucan
device the plugin also installs the necessary Rusoku Toucan device
driver, which will also detect the correct USB port.</p>
</div>
<div class="paragraph">
<p>For diagnostic purposes, the plugin logs messages into the OpenCPN
logfile,</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="paragraph">
<p>4:52:40 PM: PlugInManager: Loading PlugIn: C:\Program
Files\OpenCPN\plugins\twocan_pi.dll<br>
4:52:40 PM: C:\Program Files\OpenCPN\plugins\twocan_pi.dll<br>
API Version detected: 108<br>
PlugIn Version detected: 100<br>
4:52:40 PM: TwoCan Device, Found driver C:\Program
Files\OpenCPN\plugins\twocan_pi\drivers\filedevice.dll<br>
4:52:40 PM: TwoCan Device, Driver Manufacturer: TwoCan<br>
4:52:40 PM: TwoCan Device, Driver Name: Logfile Reader<br>
4:52:40 PM: TwoCan Device, Driver Version: 1.0<br>
4:52:40 PM: TwoCan Device, Loaded driver C:\Program
Files\OpenCPN\plugins\twocan_pi\drivers\filedevice.dll<br>
4:52:40 PM: TwoCan Plugin, TwoCan Device Initialized<br>
4:52:40 PM: TwoCan Plugin, Create Device Thread Result: 0<br>
4:52:40 PM: Changing NMEA Datasource for IIGLL to (Priority: 0)<br>
4:52:40 PM: Changing NMEA Datasource for IIMWV to (Priority: 0)<br>
4:52:40 PM: Changing NMEA Datasource for IIVHW to (Priority: 0)<br>
4:52:40 PM: Changing NMEA Datasource for IIMTW to (Priority: 0)<br>
4:52:40 PM: Changing NMEA Datasource for IIZDA to (Priority: 0)<br>
4:52:40 PM: Changing NMEA Datasource for IIVTG to (Priority: 0)<br>
4:52:40 PM: TwoCan Device, Driver Read result: 0<br>
4:52:41 PM: Changing NMEA Datasource for IIGGA to (Priority: 0)<br>
4:52:41 PM: Changing NMEA Datasource for IIDBT to (Priority: 0)<br>
4:52:45 PM: PlugInManager: Deactivating PlugIn: C:\Program
Files\OpenCPN\plugins\twocan_pi.dll<br>
4:52:45 PM: TwoCan Plugin, Device Thread Error Code: 0 Exit Code: 0<br>
4:52:45 PM: opencpn::MyFrame exiting cleanly.<br>
4:52:45 PM: Chart cache PlugIn purge<br>
4:52:45 PM: PlugInManager: Deactivating PlugIn: C:\Program
Files\OpenCPN\plugins\twocan_pi.dll<br>
4:52:45 PM: TwoCan Device, Read Thread terminating<br>
4:52:45 PM: TwoCan Device, Driver Unload Result: 0<br>
4:52:45 PM: Chart cache purge<br>
4:52:45 PM: opencpn::MyApp starting exit.<br>
4:52:45 PM: LOGBOOK: 2018-10-16 16:52:45 UTC OFF: Lat 43.41000 Lon
6.78117 COG 0.00000 SOG 0.00 kts<br>
4:52:45 PM: opencpn::MyApp exiting cleanly…</p>
</div>
<div class="paragraph">
<p>Please report any errors to either the forum or via email to
<a href="mailto:twocanplugin@hotmail.com">twocanplugin@hotmail.com</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_trivia"><a class="anchor" href="#_trivia"></a>Trivia</h3>
<div class="paragraph">
<p>Why the name “TwoCan” ? Firstly NMEA2000® is based on the Controller
Area Network (CAN). Secondly, I recall that the Year 2000 rollover was
sometimes referred to as Y2K and that Windows 2000 was sometimes
referred to as Win2K, So simply a play on words: NMEA2000® is shortened
to 2000 which becomes 2K which ends up as Two and when appended with CAN
becomes TwoCAN. But more importantly, every software project needs a
cool icon !</p>
</div>
<div class="paragraph">
<p>NMEA2000® is a registered Trademark of the National Marine Electronics
Association.</p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.
     Sources: https://gitlab.com/leamas/antora-ui-default
  </p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
